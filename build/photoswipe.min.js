!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.PhotoSwipe=b()}(this,function(){"use strict";var a=function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,p,q,u,v,w,y,z,A,B,C,D,H,I,K,L,M,N,O,P,R,T,U,V,W,X,Y,Z,ab,r,s,t,x,E,F,G,J,Q,S,$,_,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Ub,Xb,Yb,Zb,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,nc,oc,rc,sc,tc,uc,vc,wc,xc,Oc,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Vb,Wb,$b,_b,ac,mc,pc,qc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,dd,ed,bd,cd,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd,wd,xd,yd,zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd,Hd,Id,Jd,Kd,Ld,e={features:null,bind:function(a,b,c,d){var f,e=(d?"remove":"add")+"EventListener";for(b=b.split(" "),f=0;f<b.length;f++)b[f]&&a[e](b[f],c,!1)},isArray:function(a){return a instanceof Array},createEl:function(a,b){var c=document.createElement(b||"div");return a&&(c.className=a),c},getScrollY:function(){var a=window.pageYOffset;return void 0!==a?a:document.documentElement.scrollTop},unbind:function(a,b,c){e.bind(a,b,c,!0)},removeClass:function(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(a,b){e.hasClass(a,b)||(a.className+=(a.className?" ":"")+b)},hasClass:function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},getChildByClass:function(a,b){for(var c=a.firstChild;c;){if(e.hasClass(c,b))return c;c=c.nextSibling}},arraySearch:function(a,b,c){for(var d=a.length;d--;)if(a[d][c]===b)return d;return-1},extend:function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){if(c&&a.hasOwnProperty(d))continue;a[d]=b[d]}},easing:{sine:{out:function(a){return Math.sin(a*(Math.PI/2))},inOut:function(a){return-(Math.cos(Math.PI*a)-1)/2}},cubic:{out:function(a){return--a*a*a+1}}},detectFeatures:function(){var a,b,c,d,f,g,h,i,l,m,j,k,n,o,p;if(e.features)return e.features;a=e.createEl(),b=a.style,c="",d={},d.oldIE=document.all&&!document.addEventListener,d.touch="ontouchstart"in window,window.requestAnimationFrame&&(d.raf=window.requestAnimationFrame,d.caf=window.cancelAnimationFrame),d.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,d.pointerEvent||(f=navigator.userAgent,/iP(hone|od)/.test(navigator.platform)&&(g=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),g&&g.length>0&&(g=parseInt(g[1],10),g>=1&&8>g&&(d.isOldIOSPhone=!0))),h=f.match(/Android\s([0-9\.]*)/),i=h?h[1]:0,i=parseFloat(i),i>=1&&(4.4>i&&(d.isOldAndroid=!0),d.androidVersion=i),d.isMobileOpera=/opera mini|opera mobi/i.test(f)),j=["transform","perspective","animationName"],k=["","webkit","Moz","ms","O"];for(n=0;4>n;n++){for(c=k[n],o=0;3>o;o++)l=j[o],m=c+(c?l.charAt(0).toUpperCase()+l.slice(1):l),!d[l]&&m in b&&(d[l]=m);c&&!d.raf&&(c=c.toLowerCase(),d.raf=window[c+"RequestAnimationFrame"],d.raf&&(d.caf=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]))}return d.raf||(p=0,d.raf=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-p)),d=window.setTimeout(function(){a(b+c)},c);return p=b+c,d},d.caf=function(a){clearTimeout(a)}),d.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,e.features=d,d}};e.detectFeatures(),e.features.oldIE&&(e.bind=function(a,b,c,d){var f,e,g,h;for(b=b.split(" "),e=(d?"detach":"attach")+"Event",g=function(){c.handleEvent.call(c)},h=0;h<b.length;h++)if(f=b[h])if("object"==typeof c&&c.handleEvent){if(d){if(!c["oldIE"+f])return!1}else c["oldIE"+f]=g;a[e]("on"+f,c["oldIE"+f])}else a[e]("on"+f,c)}),f=this,g=25,h=3,i={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(a){return"A"===a.tagName},getDoubleTapZoom:function(a,b){return a?1:b.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"},e.extend(i,d),j=function(){return{x:0,y:0}},r=j(),s=j(),t=j(),x={},E=0,F={},G=j(),J=0,Q=!0,S=[],$={},_=!1,bb=function(a,b){e.extend(f,b.publicMethods),S.push(a)},cb=function(a){var b=hd();return a>b-1?a-b:0>a?b+a:a},db={},eb=function(a,b){return db[a]||(db[a]=[]),db[a].push(b)},fb=function(a){var c,d,b=db[a];if(b)for(c=Array.prototype.slice.call(arguments),c.shift(),d=0;d<b.length;d++)b[d].apply(f,c)},gb=function(){return(new Date).getTime()},hb=function(a){uc=a,f.bg.style.opacity=a*i.bgOpacity},ib=function(a,b,c,d,e){(!_||e&&e!==f.currItem)&&(d/=e?e.fitRatio:f.currItem.fitRatio),a[O]=A+b+"px, "+c+"px"+B+" scale("+d+")"},jb=function(a){nc&&(a&&(y>f.currItem.fitRatio?_||(pd(f.currItem,!1,!0),_=!0):_&&(pd(f.currItem),_=!1)),ib(nc,t.x,t.y,y))},kb=function(a){a.container&&ib(a.container.style,a.initialPosition.x,a.initialPosition.y,a.initialZoomLevel,a)},lb=function(a,b){b[O]=A+a+"px, 0px"+B},mb=function(a,b){if(!i.loop&&b){var c=n+(G.x*E-a)/G.x,d=Math.round(a-mc.x);(0>c&&d>0||c>=hd()-1&&0>d)&&(a=mc.x+d*i.mainScrollEndFriction)}mc.x=a,lb(a,p)},nb=function(a,b){var c=pc[a]-F[a];return s[a]+r[a]+c-c*(b/z)},ob=function(a,b){a.x=b.x,a.y=b.y,b.id&&(a.id=b.id)},pb=function(a){a.x=Math.round(a.x),a.y=Math.round(a.y)},qb=null,rb=function(){qb&&(e.unbind(document,"mousemove",rb),e.addClass(a,"pswp--has_mouse"),i.mouseUsed=!0,fb("mouseUsed")),qb=setTimeout(function(){qb=null},100)},sb=function(){e.bind(document,"keydown",f),Z.transform&&e.bind(f.scrollWrap,"click",f),i.mouseUsed||e.bind(document,"mousemove",rb),e.bind(window,"resize scroll orientationchange",f),fb("bindEvents")},tb=function(){e.unbind(window,"resize scroll orientationchange",f),e.unbind(window,"scroll",w.scroll),e.unbind(document,"keydown",f),e.unbind(document,"mousemove",rb),Z.transform&&e.unbind(f.scrollWrap,"click",f),bc&&e.unbind(window,u,f),clearTimeout(ab),fb("unbindEvents")},ub=function(a,b){var c=ld(f.currItem,x,a);return b&&(lc=c),c},vb=function(a){return a||(a=f.currItem),a.initialZoomLevel},wb=function(a){return a||(a=f.currItem),a.w>0?i.maxSpreadZoom:1},xb=function(a,b,c,d){return d===f.currItem.initialZoomLevel?(c[a]=f.currItem.initialPosition[a],!0):(c[a]=nb(a,d),c[a]>b.min[a]?(c[a]=b.min[a],!0):c[a]<b.max[a]?(c[a]=b.max[a],!0):!1)},yb=function(){if(O){var b=Z.perspective&&!R;return A="translate"+(b?"3d(":"("),B=Z.perspective?", 0px)":")",void 0}O="left",e.addClass(a,"pswp--ie"),lb=function(a,b){b.left=a+"px"},kb=function(a){var b=a.fitRatio>1?1:a.fitRatio,c=a.container.style,d=b*a.w,e=b*a.h;c.width=d+"px",c.height=e+"px",c.left=a.initialPosition.x+"px",c.top=a.initialPosition.y+"px"},jb=function(){if(nc){var a=nc,b=f.currItem,c=b.fitRatio>1?1:b.fitRatio,d=c*b.w,e=c*b.h;a.width=d+"px",a.height=e+"px",a.left=t.x+"px",a.top=t.y+"px"}}},zb=function(a){var b="";i.escKey&&27===a.keyCode?b="close":i.arrowKeys&&(37===a.keyCode?b="prev":39===a.keyCode&&(b="next")),b&&(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||(a.preventDefault?a.preventDefault():a.returnValue=!1,f[b]()))},Ab=function(a){a&&(ec||dc||oc||Yb)&&(a.preventDefault(),a.stopPropagation())},Bb=function(){f.setScrollOffset(0,e.getScrollY())},Cb={},Db=0,Eb=function(a){Cb[a]&&(Cb[a].raf&&U(Cb[a].raf),Db--,delete Cb[a])},Fb=function(a){Cb[a]&&Eb(a),Cb[a]||(Db++,Cb[a]={})},Gb=function(){for(var a in Cb)Cb.hasOwnProperty(a)&&Eb(a)},Hb=function(a,b,c,d,e,f,g){var i,j,h=gb();Fb(a),j=function(){if(Cb[a]){if(i=gb()-h,i>=d)return Eb(a),f(c),g&&g(),void 0;f((c-b)*e(i/d)+b),Cb[a].raf=T(j)}},j()},Ib={shout:fb,listen:eb,viewportSize:x,options:i,isMainScrollAnimating:function(){return oc},getZoomLevel:function(){return y},getCurrentIndex:function(){return n},isDragging:function(){return bc},isZooming:function(){return ic},setScrollOffset:function(a,b){F.x=a,Y=F.y=b,fb("updateScrollOffset",F)},applyZoomPan:function(a,b,c,d){t.x=b,t.y=c,y=a,jb(d)},setCurrentEl:function(a){o=a},init:function(){var c,d,g,j;if(!k&&!l){for(f.framework=e,f.template=a,f.bg=e.getChildByClass(a,"pswp__bg"),V=a.className,k=!0,Z=e.detectFeatures(),T=Z.raf,U=Z.caf,O=Z.transform,X=Z.oldIE,f.scrollWrap=e.getChildByClass(a,"pswp__scroll-wrap"),f.container=e.getChildByClass(f.scrollWrap,"pswp__container"),p=f.container.style,f.itemHolders=H=[{el:f.container.children[0],wrap:0,index:-1},{el:f.container.children[1],wrap:0,index:-1},{el:f.container.children[2],wrap:0,index:-1}],H[0].el.style.display=H[2].el.style.display="none",yb(),w={resize:f.updateSize,orientationchange:function(){clearTimeout(ab),ab=setTimeout(function(){x.x!==f.scrollWrap.clientWidth&&f.updateSize()},500)},scroll:Bb,keydown:zb,click:Ab},d=Z.isOldIOSPhone||Z.isOldAndroid||Z.isMobileOpera,Z.animationName&&Z.transform&&!d||(i.showAnimationDuration=i.hideAnimationDuration=0),c=0;c<S.length;c++)f["init"+S[c]]();for(b&&(g=f.ui=new b(f,e),g.init()),fb("firstUpdate"),n=n||i.index||0,(isNaN(n)||0>n||n>=hd())&&(n=0),f.currItem=gd(n),(Z.isOldIOSPhone||Z.isOldAndroid)&&(Q=!1),a.setAttribute("aria-hidden","false"),i.modal&&(Q?a.style.position="fixed":(a.style.position="absolute",a.style.top=e.getScrollY()+"px")),void 0===Y&&(fb("initialLayout"),Y=W=e.getScrollY()),j="pswp--open ",i.mainClass&&(j+=i.mainClass+" "),i.showHideOpacity&&(j+="pswp--animate_opacity "),j+=R?"pswp--touch":"pswp--notouch",j+=Z.animationName?" pswp--css_animation":"",j+=Z.svg?" pswp--svg":"",e.addClass(a,j),f.updateSize(),q=-1,J=null,c=0;h>c;c++)lb((c+q)*G.x,H[c].el.style);X||e.bind(f.scrollWrap,v,f),eb("initialZoomInEnd",function(){f.setContent(H[0],n-1),f.setContent(H[2],n+1),H[0].el.style.display=H[2].el.style.display="block",i.focus&&a.focus(),sb()}),f.setContent(H[1],n),f.updateCurrItem(),fb("afterInit"),Q||(C=setInterval(function(){Db||bc||ic||y!==f.currItem.initialZoomLevel||f.updateSize()},1e3)),e.addClass(a,"pswp--visible")}},close:function(){k&&(k=!1,l=!0,fb("close"),tb(),_c(f.currItem,null,!0,f.destroy))},destroy:function(){fb("destroy"),$c&&clearTimeout($c),a.setAttribute("aria-hidden","true"),a.className=V,C&&clearInterval(C),e.unbind(f.scrollWrap,v,f),e.unbind(window,"scroll",f),Bc(),Gb(),db=null},panTo:function(a,b,c){c||(a>lc.min.x?a=lc.min.x:a<lc.max.x&&(a=lc.max.x),b>lc.min.y?b=lc.min.y:b<lc.max.y&&(b=lc.max.y)),t.x=a,t.y=b,jb()},handleEvent:function(a){a=a||window.event,w[a.type]&&w[a.type](a)},goTo:function(a){a=cb(a);var b=a-n;J=b,n=a,f.currItem=gd(n),E-=b,mb(G.x*E),Gb(),oc=!1,f.updateCurrItem()},next:function(){f.goTo(n+1)},prev:function(){f.goTo(n-1)},updateCurrZoomItem:function(a){if(a&&fb("beforeChange",0),H[1].el.children.length){var b=H[1].el.children[0];nc=e.hasClass(b,"pswp__zoom-wrap")?b.style:null}else nc=null;lc=f.currItem.bounds,z=y=f.currItem.initialZoomLevel,t.x=lc.center.x,t.y=lc.center.y,a&&fb("afterChange")},invalidateCurrItems:function(){D=!0;for(var a=0;h>a;a++)H[a].item&&(H[a].item.needsUpdate=!0)},updateCurrItem:function(a){var c,b,d,e;if(0!==J&&(b=Math.abs(J),!(a&&2>b))){for(f.currItem=gd(n),_=!1,fb("beforeChange",J),b>=h&&(q+=J+(J>0?-h:h),b=h),d=0;b>d;d++)J>0?(c=H.shift(),H[h-1]=c,q++,lb((q+2)*G.x,c.el.style),f.setContent(c,n-b+d+1+1)):(c=H.pop(),H.unshift(c),q--,lb(q*G.x,c.el.style),f.setContent(c,n+b-d-1-1));nc&&1===Math.abs(J)&&(e=gd(I),e.initialZoomLevel!==y&&(ld(e,x),pd(e),kb(e))),J=0,f.updateCurrZoomItem(),I=n,fb("afterChange")}},updateSize:function(b){var c,d,g,j,k;if(!Q&&i.modal){if(c=e.getScrollY(),Y!==c&&(a.style.top=c+"px",Y=c),!b&&$.x===window.innerWidth&&$.y===window.innerHeight)return;$.x=window.innerWidth,$.y=window.innerHeight,a.style.height=$.y+"px"}if(x.x=f.scrollWrap.clientWidth,x.y=f.scrollWrap.clientHeight,Bb(),G.x=x.x+Math.round(x.x*i.spacing),G.y=x.y,mb(G.x*E),fb("beforeResize"),void 0!==q){for(k=0;h>k;k++)d=H[k],lb((k+q)*G.x,d.el.style),j=n+k-1,i.loop&&hd()>2&&(j=cb(j)),g=gd(j),g&&(D||g.needsUpdate||!g.bounds)?(f.cleanSlide(g),f.setContent(d,j),1===k&&(f.currItem=g,f.updateCurrZoomItem(!0)),g.needsUpdate=!1):-1===d.index&&j>=0&&f.setContent(d,j),g&&g.container&&(ld(g,x),pd(g),kb(g));D=!1}z=y=f.currItem.initialZoomLevel,lc=f.currItem.bounds,lc&&(t.x=lc.center.x,t.y=lc.center.y,jb(!0)),fb("resize")},zoomTo:function(a,b,c,d,f){var g,h,i,j,k;b&&(z=y,pc.x=Math.abs(b.x)-t.x,pc.y=Math.abs(b.y)-t.y,ob(s,t)),g=ub(a,!1),h={},xb("x",g,h,a),xb("y",g,h,a),i=y,j={x:t.x,y:t.y},pb(h),k=function(b){1===b?(y=a,t.x=h.x,t.y=h.y):(y=(a-i)*b+i,t.x=(h.x-j.x)*b+j.x,t.y=(h.y-j.y)*b+j.y),f&&f(b),jb(1===b)},c?Hb("customZoomTo",0,1,c,d||e.easing.sine.inOut,k):k(1)}},Jb=30,Kb=10,Nb={},Ob={},Pb={},Qb={},Rb={},Sb=[],Tb={},Vb=[],Wb={},$b=0,_b=j(),ac=0,mc=j(),pc=j(),qc=j(),yc=function(a,b){return a.x===b.x&&a.y===b.y},zc=function(a,b){return Math.abs(a.x-b.x)<g&&Math.abs(a.y-b.y)<g},Ac=function(a,b){return Wb.x=Math.abs(a.x-b.x),Wb.y=Math.abs(a.y-b.y),Math.sqrt(Wb.x*Wb.x+Wb.y*Wb.y)},Bc=function(){fc&&(U(fc),fc=null)},Cc=function(){bc&&(fc=T(Cc),Tc())},Dc=function(){return!("fit"===i.scaleMode&&y===f.currItem.initialZoomLevel)},Ec=function(a,b){return a&&a!==document?a.getAttribute("class")&&a.getAttribute("class").indexOf("pswp__scroll-wrap")>-1?!1:b(a)?a:Ec(a.parentNode,b):!1},Fc={},Gc=function(a,b){return Fc.prevent=!Ec(a.target,i.isClickableElement),fb("preventDragEvent",a,b,Fc),Fc.prevent},Hc=function(a,b){return b.x=a.pageX,b.y=a.pageY,b.id=a.identifier,b},Ic=function(a,b,c){c.x=.5*(a.x+b.x),c.y=.5*(a.y+b.y)},Jc=function(a,b,c){if(a-Mb>50){var d=Vb.length>2?Vb.shift():{};d.x=b,d.y=c,Vb.push(d),Mb=a}},Kc=function(){var a=t.y-f.currItem.initialPosition.y;return 1-Math.abs(a/(x.y/2))},Lc={},Mc={},Nc=[],Pc=function(a){for(;Nc.length>0;)Nc.pop();return P?(Oc=0,Sb.forEach(function(a){0===Oc?Nc[0]=a:1===Oc&&(Nc[1]=a),Oc++})):a.type.indexOf("touch")>-1?a.touches&&a.touches.length>0&&(Nc[0]=Hc(a.touches[0],Lc),a.touches.length>1&&(Nc[1]=Hc(a.touches[1],Mc))):(Lc.x=a.pageX,Lc.y=a.pageY,Lc.id="",Nc[0]=Lc),Nc},Qc=function(a,b){var c,g,l,m,d=0,e=t[a]+b[a],h=b[a]>0,j=mc.x+b.x,k=mc.x-Tb.x;return c=e>lc.min[a]||e<lc.max[a]?i.panEndFriction:1,e=t[a]+b[a]*c,!i.allowPanToNext&&y!==f.currItem.initialZoomLevel||(nc?"h"!==rc||"x"!==a||dc||(h?(e>lc.min[a]&&(c=i.panEndFriction,d=lc.min[a]-e,g=lc.min[a]-s[a]),(0>=g||0>k)&&hd()>1?(m=j,0>k&&j>Tb.x&&(m=Tb.x)):lc.min.x!==lc.max.x&&(l=e)):(e<lc.max[a]&&(c=i.panEndFriction,d=e-lc.max[a],g=s[a]-lc.max[a]),(0>=g||k>0)&&hd()>1?(m=j,k>0&&j<Tb.x&&(m=Tb.x)):lc.min.x!==lc.max.x&&(l=e))):m=j,"x"!==a)?(oc||gc||y>f.currItem.fitRatio&&(t[a]+=b[a]*c),void 0):(void 0!==m&&(mb(m,!0),gc=m===Tb.x?!1:!0),lc.min.x!==lc.max.x&&(void 0!==l?t.x=l:gc||(t.x+=b.x*c)),void 0!==m)},Rc=function(a){var b,c,d;return xc=0,wc=setInterval(function(){xc+=.1},100),"mousedown"===a.type&&a.button>0?void 0:ed?(a.preventDefault(),void 0):(Zb&&"mousedown"===a.type||(fb("pointerDown"),P&&(b=e.arraySearch(Sb,a.pointerId,"id"),0>b&&(b=Sb.length),Sb[b]={x:a.pageX,y:a.pageY,id:a.pointerId}),c=Pc(a),d=c.length,Gc(a,!0)&&d>1&&a.preventDefault(),hc=null,Gb(),bc&&1!==d||(bc=sc=!0,e.bind(window,u,f),Xb=vc=tc=Yb=gc=ec=cc=dc=!1,rc=null,fb("firstTouchStart",c),ob(s,t),r.x=r.y=0,ob(Qb,c[0]),ob(Rb,Qb),Tb.x=G.x*E,Vb=[{x:Qb.x,y:Qb.y}],Mb=Lb=gb(),ub(y,!0),Bc(),Cc()),!ic&&d>1&&!oc&&!gc&&(z=y,dc=!1,ic=cc=!0,r.y=r.x=0,ob(s,t),ob(Nb,c[0]),ob(Ob,c[1]),Ic(Nb,Ob,qc),pc.x=Math.abs(qc.x)-t.x,pc.y=Math.abs(qc.y)-t.y,jc=kc=Ac(Nb,Ob))),void 0)},Sc=function(a){var b,c,d,f;a.preventDefault(),P&&(b=e.arraySearch(Sb,a.pointerId,"id"),b>-1&&(c=Sb[b],c.x=a.pageX,c.y=a.pageY)),bc&&(d=Pc(a),rc||ec||ic?hc=d:mc.x!==G.x*E?rc="h":(f=Math.abs(d[0].x-Qb.x)-Math.abs(d[0].y-Qb.y),Math.abs(f)>=Kb&&(rc=f>0?"h":"v",hc=d)))},Tc=function(){var a,b,c,d,e,g,h,j,k,l;if(hc&&(a=hc.length,0!==a))if(ob(Nb,hc[0]),Pb.x=Nb.x-Qb.x,Pb.y=Nb.y-Qb.y,ic&&a>1){if(Qb.x=Nb.x,Qb.y=Nb.y,!Pb.x&&!Pb.y&&yc(hc[1],Ob))return;ob(Ob,hc[1]),dc||(dc=!0,fb("zoomGestureStarted")),b=Ac(Nb,Ob),c=Yc(b),c>f.currItem.initialZoomLevel+f.currItem.initialZoomLevel/15&&(vc=!0),d=1,e=vb(),g=wb(),e>c?i.pinchToClose&&!vc&&z<=f.currItem.initialZoomLevel?(h=e-c,j=1-h/(e/1.2),hb(j),fb("onPinchClose",j),tc=!0):(d=(e-c)/e,d>1&&(d=1),c=e-d*(e/3)):c>g&&(d=(c-g)/(6*e),d>1&&(d=1),c=g+d*e),0>d&&(d=0),jc=b,Ic(Nb,Ob,_b),r.x+=_b.x-qc.x,r.y+=_b.y-qc.y,ob(qc,_b),t.x=nb("x",c),t.y=nb("y",c),Xb=c>y,y=c,jb()}else{if(!rc)return;if(sc&&(sc=!1,Math.abs(Pb.x)>=Kb&&(Pb.x-=hc[0].x-Rb.x),Math.abs(Pb.y)>=Kb&&(Pb.y-=hc[0].y-Rb.y)),Qb.x=Nb.x,Qb.y=Nb.y,0===Pb.x&&0===Pb.y)return;if("v"===rc&&i.closeOnVerticalDrag&&!Dc())return r.y+=Pb.y,t.y+=Pb.y,k=Kc(),Yb=!0,fb("onVerticalDrag",k),hb(k),jb(),void 0;Jc(gb(),Nb.x,Nb.y),ec=!0,lc=f.currItem.bounds,l=Qc("x",Pb),l||(Qc("y",Pb),pb(t),jb())}},Uc=function(a){var b,c,d,h,g,j,k,l,m,n,o;if(Z.isOldAndroid){if(Zb&&"mouseup"===a.type)return;a.type.indexOf("touch")>-1&&(clearTimeout(Zb),Zb=setTimeout(function(){Zb=0},600))}if(fb("pointerUp"),Gc(a,!1)&&a.preventDefault(),P&&(c=e.arraySearch(Sb,a.pointerId,"id"),c>-1&&(b=Sb.splice(c,1)[0],navigator.pointerEnabled?b.type=a.pointerType||"mouse":(d={4:"mouse",2:"touch",3:"pen"},b.type=d[a.pointerType],b.type||(b.type=a.pointerType||"mouse")))),g=Pc(a),j=g.length,"mouseup"===a.type&&(j=0),2===j)return hc=null,!0;if(1===j&&ob(Rb,g[0]),clearInterval(wc),wc=null,0===j&&!rc&&!oc&&.3>xc&&(b||("mouseup"===a.type?b={x:a.pageX,y:a.pageY,type:"mouse"}:a.changedTouches&&a.changedTouches[0]&&(b={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,type:"touch"})),fb("touchRelease",a,b)),k=-1,0===j&&(bc=!1,e.unbind(window,u,f),Bc(),ic?k=0:-1!==ac&&(k=gb()-ac)),ac=1===j?gb():-1,h=-1!==k&&150>k?"zoom":"swipe",ic&&2>j&&(ic=!1,1===j&&(h="zoomPointerUp"),fb("zoomGestureEnded")),hc=null,ec||dc||oc||Yb){if(Gb(),Ub||(Ub=Vc()),Ub.calculateSwipeSpeed("x"),Yb)return l=Kc(),l<i.verticalDragRange?f.close():(m=t.y,n=uc,Hb("verticalDrag",0,1,300,e.easing.cubic.out,function(a){t.y=(f.currItem.initialPosition.y-m)*a+m,hb((1-n)*a+n),jb()}),fb("onVerticalDrag",1)),void 0;if((gc||oc)&&0===j){if(o=Xc(h,Ub))return;h="zoomPointerUp"}if(!oc)return"swipe"!==h?(Zc(),void 0):(!gc&&y>f.currItem.fitRatio&&Wc(Ub),void 0)}},Vc=function(){var a,b,c={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(d){Vb.length>1?(a=gb()-Mb+50,b=Vb[Vb.length-2][d]):(a=gb()-Lb,b=Rb[d]),c.lastFlickOffset[d]=Qb[d]-b,c.lastFlickDist[d]=Math.abs(c.lastFlickOffset[d]),c.lastFlickSpeed[d]=c.lastFlickDist[d]>20?c.lastFlickOffset[d]/a:0,Math.abs(c.lastFlickSpeed[d])<.1&&(c.lastFlickSpeed[d]=0),c.slowDownRatio[d]=.95,c.slowDownRatioReverse[d]=1-c.slowDownRatio[d],c.speedDecelerationRatio[d]=1},calculateOverBoundsAnimOffset:function(a,b){c.backAnimStarted[a]||(t[a]>lc.min[a]?c.backAnimDestination[a]=lc.min[a]:t[a]<lc.max[a]&&(c.backAnimDestination[a]=lc.max[a]),void 0!==c.backAnimDestination[a]&&(c.slowDownRatio[a]=.7,c.slowDownRatioReverse[a]=1-c.slowDownRatio[a],c.speedDecelerationRatioAbs[a]<.05&&(c.lastFlickSpeed[a]=0,c.backAnimStarted[a]=!0,Hb("bounceZoomPan"+a,t[a],c.backAnimDestination[a],b||300,e.easing.sine.out,function(b){t[a]=b,jb()}))))},calculateAnimOffset:function(a){c.backAnimStarted[a]||(c.speedDecelerationRatio[a]=c.speedDecelerationRatio[a]*(c.slowDownRatio[a]+c.slowDownRatioReverse[a]-c.slowDownRatioReverse[a]*c.timeDiff/10),c.speedDecelerationRatioAbs[a]=Math.abs(c.lastFlickSpeed[a]*c.speedDecelerationRatio[a]),c.distanceOffset[a]=c.lastFlickSpeed[a]*c.speedDecelerationRatio[a]*c.timeDiff,t[a]+=c.distanceOffset[a])},panAnimLoop:function(){return Cb.zoomPan&&(Cb.zoomPan.raf=T(c.panAnimLoop),c.now=gb(),c.timeDiff=c.now-c.lastNow,c.lastNow=c.now,c.calculateAnimOffset("x"),c.calculateAnimOffset("y"),jb(),c.calculateOverBoundsAnimOffset("x"),c.calculateOverBoundsAnimOffset("y"),c.speedDecelerationRatioAbs.x<.05&&c.speedDecelerationRatioAbs.y<.05)?(t.x=Math.round(t.x),t.y=Math.round(t.y),jb(),Eb("zoomPan"),void 0):void 0}};return c},Wc=function(a){return a.calculateSwipeSpeed("y"),lc=f.currItem.bounds,a.backAnimDestination={},a.backAnimStarted={},Math.abs(a.lastFlickSpeed.x)<=.05&&Math.abs(a.lastFlickSpeed.y)<=.05?(a.speedDecelerationRatioAbs.x=a.speedDecelerationRatioAbs.y=0,a.calculateOverBoundsAnimOffset("x"),a.calculateOverBoundsAnimOffset("y"),!0):(Fb("zoomPan"),a.lastNow=gb(),a.panAnimLoop(),void 0)},Xc=function(a,b){var c,d,g,h,j,k,l,m;return oc||($b=n),"swipe"===a&&(g=Qb.x-Rb.x,h=b.lastFlickDist.x<10,g>Jb&&(h||b.lastFlickOffset.x>20)?d=-1:-Jb>g&&(h||b.lastFlickOffset.x<-20)&&(d=1)),d&&(n+=d,0>n?(n=i.loop?hd()-1:0,j=!0):n>=hd()&&(n=i.loop?0:hd()-1,j=!0),(!j||i.loop)&&(J+=d,E-=d,c=!0)),k=G.x*E,l=Math.abs(k-mc.x),c||k>mc.x==b.lastFlickSpeed.x>0?(m=Math.abs(b.lastFlickSpeed.x)>0?l/Math.abs(b.lastFlickSpeed.x):333,m=Math.min(m,400),m=Math.max(m,250)):m=333,$b===n&&(c=!1),oc=!0,fb("mainScrollAnimStart"),Hb("mainScroll",mc.x,k,m,e.easing.cubic.out,mb,function(){Gb(),oc=!1,$b=-1,(c||$b!==n)&&f.updateCurrItem(),fb("mainScrollAnimComplete")}),c&&f.updateCurrItem(!0),c},Yc=function(a){return 1/kc*a*z},Zc=function(){var g,d,h,a=y,b=vb(),c=wb();return b>y?a=b:y>c&&(a=c),d=1,h=uc,tc&&!Xb&&!vc&&b>y?(f.close(),!0):(tc&&(g=function(a){hb((d-h)*a+h)}),f.zoomTo(a,0,200,e.easing.cubic.out,g),!0)},bb("Gestures",{publicMethods:{initGestures:function(){var a=function(a,b,c,d,e){K=a+b,L=a+c,M=a+d,N=e?a+e:""};P=Z.pointerEvent,P&&Z.touch&&(Z.touch=!1),P?navigator.pointerEnabled?a("pointer","down","move","up","cancel"):a("MSPointer","Down","Move","Up","Cancel"):Z.touch?(a("touch","start","move","end","cancel"),R=!0):a("mouse","down","move","up"),u=L+" "+M+" "+N,v=K,P&&!R&&(R=navigator.maxTouchPoints>1||navigator.msMaxTouchPoints>1),f.likelyTouchDevice=R,w[K]=Rc,w[L]=Sc,w[M]=Uc,N&&(w[N]=w[M]),Z.touch&&(v+=" mousedown",u+=" mousemove mouseup",w.mousedown=w[K],w.mousemove=w[L],w.mouseup=w[M]),R||(i.allowPanToNext=!1)}}}),_c=function(b,c,d,g){var h,j,k,l;return $c&&clearTimeout($c),ed=!0,dd=!0,b.initialLayout?(h=b.initialLayout,b.initialLayout=null):h=i.getThumbBoundsFn&&i.getThumbBoundsFn(n,o),j=d?i.hideAnimationDuration:i.showAnimationDuration,k=function(){Eb("initialZoom"),d?(f.template.removeAttribute("style"),f.bg.removeAttribute("style")):(hb(1),c&&(c.style.display="block"),e.addClass(a,"pswp--animated-in"),fb("initialZoom"+(d?"OutEnd":"InEnd"))),g&&g(),ed=!1},j&&h&&void 0!==h.x?(l=function(){var c=m,g=!f.currItem.src||f.currItem.loadError||i.showHideOpacity;b.miniImg&&(b.miniImg.style.webkitBackfaceVisibility="hidden"),d||(y=h.w/b.w,t.x=h.x,t.y=h.y-W,f[g?"template":"bg"].style.opacity=.001,jb()),Fb("initialZoom"),d&&!c&&e.removeClass(a,"pswp--animated-in"),g&&(d?e[(c?"remove":"add")+"Class"](a,"pswp--animate_opacity"):setTimeout(function(){e.addClass(a,"pswp--animate_opacity")},30)),$c=setTimeout(function(){if(fb("initialZoom"+(d?"Out":"In")),d){var f=h.w/b.w,i={x:t.x,y:t.y},l=y,m=uc,n=function(b){1===b?(y=f,t.x=h.x,t.y=h.y-Y):(y=(f-l)*b+l,t.x=(h.x-i.x)*b+i.x,t.y=(h.y-Y-i.y)*b+i.y),jb(),g?a.style.opacity=1-b:hb(m-b*m)};c?Hb("initialZoom",0,1,j,e.easing.cubic.out,n,k):(n(1),$c=setTimeout(k,j+20))}else y=b.initialZoomLevel,ob(t,b.initialPosition),jb(),hb(1),g?a.style.opacity=1:hb(1),$c=setTimeout(k,j+20)},d?25:90)},l(),void 0):(fb("initialZoom"+(d?"Out":"In")),y=b.initialZoomLevel,ob(t,b.initialPosition),jb(),a.style.opacity=d?0:1,hb(1),j?setTimeout(function(){k()},j):k(),void 0)},bd={},cd=[],fd={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return ad.length}},jd=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},kd=function(a,b,c){var d=a.bounds;d.center.x=Math.round((bd.x-b)/2),d.center.y=Math.round((bd.y-c)/2)+a.vGap.top,d.max.x=b>bd.x?Math.round(bd.x-b):d.center.x,d.max.y=c>bd.y?Math.round(bd.y-c)+a.vGap.top:d.center.y,d.min.x=b>bd.x?0:d.center.x,d.min.y=c>bd.y?a.vGap.top:d.center.y},ld=function(a,b,c){var d,e,f,g;if(a.src&&!a.loadError){if(d=!c,d&&(a.vGap||(a.vGap={top:0,bottom:0}),fb("parseVerticalMargin",a)),bd.x=b.x,bd.y=b.y-a.vGap.top-a.vGap.bottom,d&&(e=bd.x/a.w,f=bd.y/a.h,a.fitRatio=f>e?e:f,g=i.scaleMode,"orig"===g?c=1:"fit"===g&&(c=a.fitRatio),c>1&&(c=1),a.initialZoomLevel=c,a.bounds||(a.bounds=jd())),!c)return;return kd(a,a.w*c,a.h*c),d&&c===a.initialZoomLevel&&(a.initialPosition=a.bounds.center),a.bounds}return a.w=a.h=0,a.initialZoomLevel=a.fitRatio=1,a.bounds=jd(),a.initialPosition=a.bounds.center,a.bounds},md=function(a,b,c,d,e,g){b.loadError||d&&(b.imageAppended=!0,pd(b,d,b===f.currItem&&_),c.appendChild(d),g&&setTimeout(function(){b&&b.loaded&&b.placeholder&&(b.placeholder.style.display="none",b.placeholder=null)},500))},nd=function(a){var b,c;return a.loading=!0,a.loaded=!1,b=a.img=e.createEl("pswp__img","img"),c=function(){a.loading=!1,a.loaded=!0,a.loadComplete?a.loadComplete(a):a.img=null,b.onload=b.onerror=null,b=null},b.onload=c,b.onerror=function(){a.loadError=!0,c()},b.src=a.src,b},od=function(a,b){return a.src&&a.loadError&&a.container?(b&&(a.container.innerHTML=""),a.container.innerHTML=i.errorMsg.replace("%url%",a.src),!0):void 0},pd=function(a,b,c){if(a.src){b||(b=a.container.lastChild);var d=c?a.w:Math.round(a.w*a.fitRatio),e=c?a.h:Math.round(a.h*a.fitRatio);a.placeholder&&!a.loaded&&(a.placeholder.style.width=d+"px",a.placeholder.style.height=e+"px"),b.style.width=d+"px",b.style.height=e+"px"}},qd=function(){var a,b;if(cd.length){for(b=0;b<cd.length;b++)a=cd[b],a.holder.index===a.index&&md(a.index,a.item,a.baseDiv,a.img,!1,a.clearPlaceholder);cd=[]}},bb("Controller",{publicMethods:{lazyLoadItem:function(a){a=cb(a);var b=gd(a);b&&(!b.loaded&&!b.loading||D)&&(fb("gettingData",a,b),b.src&&nd(b))},initController:function(){e.extend(i,fd,!0),f.items=ad=c,gd=f.getItemAt,hd=i.getNumItemsFn,id=i.loop,hd()<3&&(i.loop=!1),eb("beforeChange",function(a){var g,b=i.preload,c=null===a?!0:a>=0,d=Math.min(b[0],hd()),e=Math.min(b[1],hd());for(g=1;(c?e:d)>=g;g++)f.lazyLoadItem(n+g);for(g=1;(c?d:e)>=g;g++)f.lazyLoadItem(n-g)}),eb("initialLayout",function(){f.currItem.initialLayout=i.getThumbBoundsFn&&i.getThumbBoundsFn(n,o)}),eb("mainScrollAnimComplete",qd),eb("initialZoomInEnd",qd),eb("destroy",function(){var a,b;for(b=0;b<ad.length;b++)a=ad[b],a.container&&(a.container=null),a.placeholder&&(a.placeholder=null),a.img&&(a.img=null),a.preloader&&(a.preloader=null),a.loadError&&(a.loaded=a.loadError=!1);cd=null})},getItemAt:function(a){return a>=0?void 0!==ad[a]?ad[a]:!1:!1},allowProgressiveImg:function(){return i.forceProgressiveLoading||!R||i.mouseUsed||screen.width>1200},setContent:function(a,b){var c,g,d,h,j,l;return i.loop&&(b=cb(b)),c=f.getItemAt(a.index),c&&(c.container=null),(d=f.getItemAt(b))?(fb("gettingData",b,d),a.index=b,a.item=d,h=d.container=e.createEl("pswp__zoom-wrap"),!d.src&&d.html&&(d.html.tagName?h.appendChild(d.html):h.innerHTML=d.html),od(d),ld(d,x),!d.src||d.loadError||d.loaded?d.src&&!d.loadError&&(g=e.createEl("pswp__img","img"),g.style.opacity=1,g.src=d.src,pd(d,g),md(b,d,h,g,!0)):(d.loadComplete=function(c){if(k){if(a&&a.index===b){if(od(c,!0))return c.loadComplete=c.img=null,ld(c,x),kb(c),a.index===n&&f.updateCurrZoomItem(),void 0;c.imageAppended?!ed&&c.placeholder&&(c.placeholder.style.display="none",c.placeholder=null):Z.transform&&(oc||ed)?cd.push({item:c,baseDiv:h,img:c.img,index:b,holder:a,clearPlaceholder:!0}):md(b,c,h,c.img,oc||ed,!0)}c.loadComplete=null,c.img=null,fb("imageLoadComplete",b,c)}},e.features.transform&&(j="pswp__img pswp__img--placeholder",j+=d.msrc?"":" pswp__img--placeholder--blank",l=e.createEl(j,d.msrc?"img":""),d.msrc&&(l.src=d.msrc),pd(d,l),h.appendChild(l),d.placeholder=l),d.loading||nd(d),f.allowProgressiveImg()&&(!dd&&Z.transform?cd.push({item:d,baseDiv:h,img:d.img,index:b,holder:a}):md(b,d,h,d.img,!0,!0))),dd||b!==n?kb(d):(nc=h.style,_c(d,g||d.img)),a.el.innerHTML="",a.el.appendChild(h),void 0):(a.el.innerHTML="",void 0)},cleanSlide:function(a){a.img&&(a.img.onload=a.img.onerror=null),a.loaded=a.loading=a.img=a.imageAppended=!1}}}),sd={},td=function(a,b,c){var d=document.createEvent("CustomEvent"),e={origEvent:a,target:a.target,releasePoint:b,pointerType:c||"touch"};d.initCustomEvent("pswpTap",!0,!0,e),a.target.dispatchEvent(d)},bb("Tap",{publicMethods:{initTap:function(){eb("firstTouchStart",f.onTapStart),eb("touchRelease",f.onTapRelease),eb("destroy",function(){sd={},rd=null})},onTapStart:function(a){a.length>1&&(clearTimeout(rd),rd=null)},onTapRelease:function(a,b){function c(){var a=navigator.userAgent.toLowerCase(),b="ipad"==a.match(/ipad/i),c="iphone os"==a.match(/iphone os/i),d="midp"==a.match(/midp/i),e="rv:1.2.3.4"==a.match(/rv:1.2.3.4/i),f="ucweb"==a.match(/ucweb/i),g="android"==a.match(/android/i),h="windows ce"==a.match(/windows ce/i),i="windows mobile"==a.match(/windows mobile/i);return b||c||d||e||f||g||h||i?!1:!0}var d,f;if(b&&!(!c()&&"mouse"===b.type||ec||cc||Db)){if(d=b,rd&&(clearTimeout(rd),rd=null,zc(d,sd)))return fb("doubleTap",d),void 0;if("mouse"===b.type&&c())return td(a,b,"mouse"),void 0;if(f=a.target.tagName.toUpperCase(),"BUTTON"===f||e.hasClass(a.target,"pswp__single-tap"))return td(a,b),void 0;ob(sd,d),rd=setTimeout(function(){td(a,b),rd=null},300)}}}}),bb("DesktopZoom",{publicMethods:{initDesktopZoom:function(){X||(R?eb("mouseUsed",function(){f.setupDesktopZoom()}):f.setupDesktopZoom(!0))},setupDesktopZoom:function(b){var c,d,g,h;ud={},c="wheel mousewheel DOMMouseScroll",eb("bindEvents",function(){e.bind(a,c,f.handleMouseWheel)}),eb("unbindEvents",function(){ud&&e.unbind(a,c,f.handleMouseWheel)}),f.mouseZoomedIn=!1,g=function(){f.mouseZoomedIn&&(e.removeClass(a,"pswp--zoomed-in"),f.mouseZoomedIn=!1),1>y?e.addClass(a,"pswp--zoom-allowed"):e.removeClass(a,"pswp--zoom-allowed"),h()},h=function(){d&&(e.removeClass(a,"pswp--dragging"),d=!1)},eb("resize",g),eb("afterChange",g),eb("pointerDown",function(){f.mouseZoomedIn&&(d=!0,e.addClass(a,"pswp--dragging"))}),eb("pointerUp",h),b||g()},handleMouseWheel:function(a){if(y<=f.currItem.fitRatio)return i.modal&&(!i.closeOnScroll||Db||bc?a.preventDefault():O&&Math.abs(a.deltaY)>2&&(m=!0,f.close())),!0;if(a.stopPropagation(),ud.x=0,"deltaX"in a)1===a.deltaMode?(ud.x=18*a.deltaX,ud.y=18*a.deltaY):(ud.x=a.deltaX,ud.y=a.deltaY);else if("wheelDelta"in a)a.wheelDeltaX&&(ud.x=-.16*a.wheelDeltaX),ud.y=a.wheelDeltaY?-.16*a.wheelDeltaY:-.16*a.wheelDelta;else{if(!("detail"in a))return;ud.y=a.detail}ub(y,!0);var b=t.x-ud.x,c=t.y-ud.y;(i.modal||b<=lc.min.x&&b>=lc.max.x&&c<=lc.min.y&&c>=lc.max.y)&&a.preventDefault(),f.panTo(b,c)},toggleDesktopZoom:function(b){var c,d;b=b||{x:x.x/2+F.x,y:x.y/2+F.y},c=i.getDoubleTapZoom(!0,f.currItem),d=y===c,f.mouseZoomedIn=!d,f.zoomTo(d?f.currItem.initialZoomLevel:c,b,333),e[(d?"remove":"add")+"Class"](a,"pswp--zoomed-in")}}}),vd={history:!0,galleryUID:1},Id=function(){return Gd.hash.substring(1)},Jd=function(){wd&&clearTimeout(wd),yd&&clearTimeout(yd)},Kd=function(){var c,d,e,f,a=Id(),b={};if(a.length<5)return b;for(d=a.split("&"),c=0;c<d.length;c++)d[c]&&(e=d[c].split("="),e.length<2||(b[e[0]]=e[1]));if(i.galleryPIDs){for(f=b.pid,b.pid=0,c=0;c<ad.length;c++)if(ad[c].pid===f){b.pid=c;break}}else b.pid=parseInt(b.pid,10)-1;return b.pid<0&&(b.pid=0),b},Ld=function(){var a,b,c,d;return yd&&clearTimeout(yd),Db||bc?(yd=setTimeout(Ld,500),void 0):(zd?clearTimeout(xd):zd=!0,a=n+1,b=gd(n),b.hasOwnProperty("pid")&&(a=b.pid),c=Cd+"&"+"gid="+i.galleryUID+"&"+"pid="+a,Dd||-1===Gd.hash.indexOf(c)&&(Fd=!0),d=Gd.href.split("#")[0]+"#"+c,Hd?"#"+c!==window.location.hash&&history[Dd?"replaceState":"pushState"]("",document.title,d):Dd?Gd.replace(d):Gd.hash=c,Dd=!0,xd=setTimeout(function(){zd=!1},60),void 0)},bb("History",{publicMethods:{initHistory:function(){var a,b;e.extend(i,vd,!0),i.history&&(Gd=window.location,Fd=!1,Ed=!1,Dd=!1,Cd=Id(),Hd="pushState"in history,Cd.indexOf("gid=")>-1&&(Cd=Cd.split("&gid=")[0],Cd=Cd.split("?gid=")[0]),eb("afterChange",f.updateURL),eb("unbindEvents",function(){e.unbind(window,"hashchange",f.onHashChange)}),a=function(){Bd=!0,Ed||(Fd?history.back():Cd?Gd.hash=Cd:Hd?history.pushState("",document.title,Gd.pathname+Gd.search):Gd.hash=""),Jd()
},eb("unbindEvents",function(){m&&a()}),eb("destroy",function(){Bd||a()}),eb("firstUpdate",function(){n=Kd().pid}),b=Cd.indexOf("pid="),b>-1&&(Cd=Cd.substring(0,b),"&"===Cd.slice(-1)&&(Cd=Cd.slice(0,-1))),setTimeout(function(){k&&e.bind(window,"hashchange",f.onHashChange)},40))},onHashChange:function(){return Id()===Cd?(Ed=!0,f.close(),void 0):(zd||(Ad=!0,f.goTo(Kd().pid),Ad=!1),void 0)},updateURL:function(){Jd(),Ad||(Dd?wd=setTimeout(Ld,800):Ld())}}}),e.extend(f,Ib)};return a});